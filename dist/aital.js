(function(){"use strict";const b="",m=i=>{let[g,s]=[50,10];i.aitalPosition&&(g=i.aitalPosition.x,s=i.aitalPosition.y);const o=document.getElementById("aital");o&&(o.style.left=`${g}%`,o.style.top=`${s}%`)};(()=>{if(window.hasRun)return;window.hasRun=!0;const i=document.createElement("details");i.open=!0,i.id="aital",i.dataset.id="aital";const g=document.createElement("summary");g.innerHTML=`
    <span>Am I Talking A Lot?</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="192" height="192" fill="#000000" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="208 96 128 176 48 96" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></polyline></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="192" height="192" fill="#000000" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="48 160 128 80 208 160" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></polyline></svg>
  `,i.appendChild(g);const s=document.createElement("div");i.appendChild(s),browser.storage.sync.get("aitalPosition").then(m).catch(t=>console.error("AITAL error: could not get position from storage",t)),browser.runtime.onMessage.addListener(t=>{if(t.command==="aitalUpdatePosition")return m(t),Promise.resolve()}),document.body.appendChild(i),window.__aitalDebugMode=!1;const o={__seconds:0},f={};let a,p;function c(){window.__aitalDebugMode&&console.log("ðŸª² AITAL",...arguments,{data:o,elements:f,participants:p,indicators:a})}function y(t){const h=t.split(" ");return h.length===1?t:h.map((e,n)=>n===0?e:e[0]+".").join(" ")}function v(t){return t>=90?3:t>=75?2:t>=50?1:0}function x(){if(p=document.querySelectorAll("[data-self-name]"),p.length<=1)return;o.__seconds++,a=[],document.querySelectorAll("i.google-material-icons").forEach(e=>{if(e.textContent==="devices"){const n=e.previousSibling;if(!n){c("No previous sibling for node",e);return}n.dataset.useTooltip?a.push(n.lastChild):a.push(n)}}),a.forEach((e,n)=>{const l=p[n];if(!l){c("No matching participant for indicator",{index:n,indicators:a,node:e,participants:p});return}const r=l.textContent;r.includes("(Present")&&c("Unexpected participant: "+r,{indicators:a,participants:p}),o.hasOwnProperty(r)||(c(`Logging new participant: ${r}`),o[r]=0),e.children[1].getBoundingClientRect().height>4&&(c(`Talking: ${r}`),o[r]++)});const{__seconds:t,...h}=o;Object.entries(h).forEach(([e,n])=>{const l=n*100/t,r=l.toFixed(2);if(f[e]){c(`Update UI: ${e}`);const{progress:d,percent:u}=f[e];d.value=l,d.dataset.level=v(l),u.textContent=r}else{c(`Create UI: ${e}`);const d=document.createElement("label");d.textContent=y(e),d.title=e;const u=document.createElement("progress");u.max=100,u.value=l,u.dataset.level=v(l).toString();const w=document.createElement("span");w.textContent=r,s.appendChild(d),s.appendChild(u),s.appendChild(w),f[e]={label:d,percent:w,progress:u}}})}s.addEventListener("click",t=>{t.shiftKey&&(window.__aitalDebugMode=!window.__aitalDebugMode)}),setInterval(x,1e3)})()})();
